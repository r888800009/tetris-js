<canvas id="screen" width="600" height="600" style="border:1px solid #555555;"></canvas>
<script>
var screen;
var sct;      
var w = 600, h = 600;  
var BlockSize = 20;
var fps = 100.0;
var keyBool = new Array(128);

var colors = {
    blocks:         [
                        "#996600",
                        "#6688EE",
                        "#FFCC00",
                        "#CC9933",
                        "#EE99CC",
                        "#9933EE",
                        "#BB99FF"
                    ],
    bg:             "#555555",
    screenBG:       "#000000",
    screenBlock:    "#222222"
};

var mapW = 10, mapH = 20, mapX = 10, mapY = 10, map;
var queueDisplayX = (mapW + 1) * BlockSize, queueDisplayY = mapY;
var gameRunning = true;
var gameTimer;
var pointX = 0, pointY = 0;
var blocks = [
    [
        1,1,1,1,
        0,0,0,0,
        0,0,0,0,
        0,0,0,0
    ],
    [
        2,2,2,0,
        0,0,2,0,
        0,0,0,0,
        0,0,0,0
    ],
    [
        3,3,3,0,
        3,0,0,0,
        0,0,0,0,
        0,0,0,0
    ],
    [
        4,4,0,0,
        4,4,0,0,
        0,0,0,0,
        0,0,0,0
    ],
    [
        0,5,5,0,
        5,5,0,0,
        0,0,0,0,
        0,0,0,0
    ],
    [
        6,6,6,0,
        0,6,0,0,
        0,0,0,0,
        0,0,0,0
    ],
    [
        7,7,0,0,
        0,7,7,0,
        0,0,0,0,
        0,0,0,0
    ],
];

var useBlock;
var queueBlock;

function createNewMap()
{
    map = new Array(mapW);
    for (var x = 0; x < mapW; x++) {
            map[x] = new Array(mapH);
        for (var y = 0; y < mapH; y++) 
            map[x][y] = 0;
    }
    newBlock();
}

function newBlock()
{
    var blockUse = Math.floor(Math.random() * 7);
    queueBlock = Math.floor(Math.random() * 7);
    useBlock = new Array(4 * 4);
    for (var i = 0; i < useBlock.length; i++) {
        useBlock[i] = blocks[blockUse][i];
    }
    pointX = mapW / 2 - 2;
    pointY = 0;
}

function gameStart()
{
    createNewMap();
    gameRunning = true;
    gameTimer = setInterval(gameTick, 500);
}

function main()
{
    screen1 = document.getElementById('screen');   
    sct = screen1.getContext('2d');
    sct.fillStyle = colors.bg;
   
    // init
    // Keyboard Init
    for (var i = 0; i < keyBool.length; i++) 
        keyBool[i] = false;

    DisplayTimer = setInterval(display, 1000.0 / fps);
    gameStart(); 

    return 0; 
}

function gameTick()
{
    moveDown();
}

function blockPaint(onScreenX, onScreenY, x, y, useBlackground)
{
    if (useBlackground == 0) {
            sct.fillStyle = colors.screenBlock;
    } else {
            sct.fillStyle = colors.blocks[useBlackground - 1];
    }
    sct.fillRect(onScreenX + (BlockSize) * x + 1, onScreenY + (BlockSize) * y + 1, BlockSize - 2, BlockSize - 2);
}

function display()
{
    // clean
    sct.fillStyle = colors.bg;
    sct.fillRect(0, 0, w, h);

    // Display background 
    sct.fillStyle = colors.screenBG;
    sct.fillRect(mapX, mapY, BlockSize * mapW, BlockSize * mapH);
    
    for (var x = 0; x < mapW; x++) {
        for (var y = 0; y < mapH; y++) {
            blockPaint(mapX, mapY, x, y, map[x][y]);
        }
    }

    // Display 
    for (var x = 0; x < 4; x++) {
        for (var y = 0; y < 4; y++) {
            // Block queue
            if(blocks[queueBlock][x + y * 4] != 0) {
                blockPaint(queueDisplayX, queueDisplayY, x, y, blocks[queueBlock][x + y * 4]);    
            }   
            // Block current
            if (useBlock[x + y * 4] != 0) {
                blockPaint(mapX, mapY, pointX + x, pointY + y, useBlock[x + y * 4]);    
            }
        }
    }
}

function gameOver()
{
    gameRunning = false;
    window.clearInterval(gameTimer);
}

function collisionTest(addX, addY)
{
    for (var x = 0; x < 4; x++) {
        for (var y = 0; y < 4; y++) {
            if (useBlock[x + y * 4] != 0) {
                if (pointX + x + addX <  0    ||
                    pointX + x + addX >= mapW ||
                    pointY + y + addY >= mapH )
                {
                    return true;
                } else if (map[pointX + x + addX][pointY + y + addY] != 0) {
                    return true;
                }
            }
        }
    }
    return false;
}

function lineTest()
{

}
//event

function rotate() 
{

}

function moveRight() 
{
    if (!collisionTest(1, 0))
        pointX++;
}

function moveLeft() 
{
    if (!collisionTest(-1, 0))
        pointX--;
}

function moveDown()
{
    if (gameRunning == true) {
        if (!collisionTest(0, 1))
            pointY++;
        else {
            if (pointY == 0)
                gameOver();
            for (var x = 0; x < 4; x++) {
                for (var y = 0; y < 4; y++) {
                    if (useBlock[x + y * 4] != 0) {
                        map[pointX + x][pointY + y] = useBlock[x + y * 4];
                    }
                }
                lineTest();
            }
            newBlock();
        }
    }
}

function keyDown(e)
{
    e = e || window.event;

    if (e.keyCode < 128) {
        if (keyBool[e.keyCode] == false) {
            keyBool[e.keyCode] == true;
            console.log("keyDown");
            
            if([38, 40, 37, 39].indexOf(e.keyCode) > -1) {
                e.preventDefault();
            }

            if (e.keyCode == '38') //up
                rotate();
            
            if (e.keyCode == '40') //down
                moveDown();
            
            if (e.keyCode == '37') //left
                moveLeft();
            
            if (e.keyCode == '39') //right
                moveRight();
        }

    }
}

function keyUp(e)
{
    e = e || window.event;

    if (e.keyCode < 128) {
        if (keyBool[e.keyCode] == true) {
            keyBool[e.keyCode] == false;
        }
    }
}
window.onload    = main;
window.onkeydown = keyDown;
window.onkeyup   = keyUp;
</script>
<br>
The game is not done.
<a href="https://github.com/r888800009/tetris-js"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
<br>
<a href="https://github.com/r888800009/">r888800009</a>
